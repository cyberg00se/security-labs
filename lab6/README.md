# Lab6: Sensitive information storage

## Весь проект:

[тык сюда](https://github.com/cyberg00se/chirpy-app)

(добавила поле с номером телефона)

## 1. Что происходит с номером телефона
Почитала [это](https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html) и [это](https://cloud.google.com/kms/docs/envelope-encryption). 

Шифрование поля происходит на уровне приложения. [место в коде (в сеттере поля шифрование, в геттере дешифрование)]( https://github.com/cyberg00se/chirpy-app/blob/main/chirpy-app-backend/src/api/user/models/User.js)

Для каждого пользователя поле шифруется отдельным ключом (Data Encryption Key). Потом этот DEK шифруется другим ключом (Key Encryption Key), это envelope encryption. Уже зашифрованные номер телефона и DEK кладутся в БД вместе. При каждой записи новых данных в зашифрованное поле, генерируется новый DEK c помощью ```crypto.randomBytes()```.
KEK в данном случае хранится отдельно от БД с данными, в переменной в файле ```.env``` (ничего умнее для хранения ключа без использования KMS я не придумала).

## 2. Как именно шифруются данные

[код тут](https://github.com/cyberg00se/chirpy-app/blob/main/chirpy-app-backend/src/lib/cipher/cipher.js)

Используется алгоритм AES256-GCM (из ```crypto```), там сразу есть аутентификация. Длина ключей, соответственно, 256 бит (32 байта).

## 3. Подводные камни

- у меня не предусмотрена никакая автоматическая ротация KEK
- получается, что хранится KEK в обычном файле конфигов (по-хорошему надо для этого файла как-то ограничить доступ на уровне файловой системы)
- в конце-концов, данные могут украсть прям сразу вместе с моим ноутом :) но это очень маловероятно, поэтому смысла что-то шифровать на уровне железа нет